<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Letras</title>

<style>
body { margin:0; font-family:sans-serif; background:#000; color:#fff; }
header { text-align:center; padding:15px; font-size:24px; font-weight:bold; color:#00aaff; }

#contagem { text-align:center; margin-bottom:10px; color:#00aaff; }

#menu { padding:10px; }

.musicaItem {
  background:#0a0a0a;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  border:1px solid #00aaff33;
}

.musicaItemContent {
  display:flex;
  align-items:center;
  flex:1;
}

.menuCapa {
  width:50px;
  height:50px;
  object-fit:cover;
  border-radius:8px;
  margin-right:10px;
}

.musicaNome { font-weight:bold; color:#00aaff; }
.musicaBanda { font-size:0.9em; color:#aaa; }

.selecionarCheckbox {
  margin-left:10px;
}

/* BOTÃO DE ADICIONAR MÚSICA */
#addMusica {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:50%;
  width:60px;
  height:60px;
  font-size:30px;
  cursor:pointer;
  border:2px solid #00aaff33;
}

/* BOTÕES DE MULTI E ORDEM */
#toggleOrdem {
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 12px;
  cursor:pointer;
  border:2px solid #00aaff33;
  margin-left:5px;
}

#btnFotoMulti {
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 12px;
  cursor:pointer;
  border:2px solid #ffaa0033;
  margin-left:5px;
}

#btnApagarMulti {
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 12px;
  cursor:pointer;
  border:2px solid #ff000033;
  display:none;
  margin-left:5px;
}

/* BARRA DE PESQUISA */
#barraPesquisa {
  width:90%;
  margin:10px auto;
  display:block;
  padding:8px 12px;
  border-radius:8px;
  border:2px solid #00aaff33;
  background:#1c1c1c;
  color:#fff;
  font-size:16px;
}

/* TELA DE MÚSICA */
#musicaTela { display:none; padding:15px; }

#btnVoltar {
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 12px;
  margin-bottom:10px;
  cursor:pointer;
  border:2px solid #00aaff33;
}

#nomeMusicaTela { font-size:22px; font-weight:bold; color:#00aaff; }
#nomeBandaTela { color:#aaa; margin-bottom:15px; }

#capaMusica {
  width:100%;
  max-height:200px;
  object-fit:cover;
  border-radius:12px;
  margin-bottom:10px;
  display:none;
}

#btnFoto {
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:8px 12px;
  margin-bottom:15px;
  cursor:pointer;
  border:2px solid #00aaff33;
}

/* LETRA */
#letra {
  white-space:pre-wrap;
  line-height:1.6em;
  font-size:24px; /* PADRÃO FIXO */
}

#btnAddEditarLetra {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#1c1c1c;
  color:#fff;
  border:none;
  border-radius:50%;
  width:60px;
  height:60px;
  font-size:24px;
  cursor:pointer;
  display:none;
  border:2px solid #00aaff33;
}
</style>
</head>

<body>

<header>Músicas</header>
<input type="text" id="barraPesquisa" placeholder="Pesquisar música ou banda...">

<div id="contagem"></div>

<!-- BOTÕES DE ORDEM E MULTI -->
<div style="text-align:center; margin-bottom:10px;">
  <button id="toggleOrdem">A → Z</button>
  <button id="btnFotoMulti">Aplicar capa em várias</button>
  <button id="btnApagarMulti">Apagar selecionadas</button>
</div>

<div id="menu"></div>

<button id="addMusica">+</button>

<div id="musicaTela">
  <button id="btnVoltar">← Menu</button>
  <div id="nomeMusicaTela"></div>
  <div id="nomeBandaTela"></div>
  <img id="capaMusica">
  <button id="btnFoto">Adicionar / Trocar Foto</button>
  <div id="letra"></div>
</div>

<button id="btnAddEditarLetra">✏️</button>

<script>
let musicas = JSON.parse(localStorage.getItem("musicas")) || [];
let musicaAtual = null;
let ordemInvertida = false;

const menu = document.getElementById("menu");
const contagem = document.getElementById("contagem");
const addMusica = document.getElementById("addMusica");
const musicaTela = document.getElementById("musicaTela");
const nomeMusicaTela = document.getElementById("nomeMusicaTela");
const nomeBandaTela = document.getElementById("nomeBandaTela");
const letraDiv = document.getElementById("letra");
const btnAddEditarLetra = document.getElementById("btnAddEditarLetra");
const capaMusica = document.getElementById("capaMusica");
const btnVoltar = document.getElementById("btnVoltar");
const btnFoto = document.getElementById("btnFoto");
const toggleOrdem = document.getElementById("toggleOrdem");
const btnFotoMulti = document.getElementById("btnFotoMulti");
const btnApagarMulti = document.getElementById("btnApagarMulti");
const barraPesquisa = document.getElementById("barraPesquisa");

function capitalizar(str){
  return str.replace(/\b\w/g, c => c.toUpperCase());
}

function salvar() {
  localStorage.setItem("musicas", JSON.stringify(musicas));
}

function atualizarMenu() {
  menu.innerHTML = "";
  const pesquisa = barraPesquisa.value.toLowerCase();
  contagem.innerText = musicas.length + " músicas";

  let lista = ordemInvertida ? [...musicas].reverse() : musicas;

  // Filtrar músicas pelo início do nome ou banda
  if (pesquisa.trim() !== "") {
    lista = lista.filter(m => 
      m.nome.toLowerCase().startsWith(pesquisa) ||
      m.banda.toLowerCase().startsWith(pesquisa)
    );
  }

  lista.forEach((m, i) => {
    const item = document.createElement("div");
    item.className = "musicaItem";
    item.innerHTML = `
      <div class="musicaItemContent">
        ${m.capa ? `<img src="${m.capa}" class="menuCapa">` : ""}
        <div>
          <div class="musicaNome">${m.nome}</div>
          <div class="musicaBanda">${m.banda}</div>
        </div>
      </div>
      <input type="checkbox" class="selecionarCheckbox" data-index="${musicas.indexOf(m)}">
    `;
    item.onclick = (e) => {
      if(!e.target.classList.contains("selecionarCheckbox")) abrirMusica(musicas.indexOf(m));
    };
    menu.appendChild(item);
  });

  const checkboxes = document.querySelectorAll(".selecionarCheckbox");
  btnApagarMulti.style.display = Array.from(checkboxes).some(chk => chk.checked) ? "inline-block" : "none";

  checkboxes.forEach(chk => {
    chk.onchange = () => {
      btnApagarMulti.style.display = Array.from(checkboxes).some(chk => chk.checked) ? "inline-block" : "none";
    };
  });
}

function apagarSelecionadas(){
  const checkboxes = document.querySelectorAll(".selecionarCheckbox:checked");
  const indices = Array.from(checkboxes).map(chk => parseInt(chk.dataset.index)).sort((a,b)=>b-a);
  indices.forEach(i => musicas.splice(i,1));
  salvar();
  atualizarMenu();
}

function abrirMusica(index) {
  musicaAtual = index;
  const m = musicas[index];

  menu.style.display = "none";
  addMusica.style.display = "none";
  musicaTela.style.display = "block";
  btnAddEditarLetra.style.display = "block";

  nomeMusicaTela.innerText = m.nome;
  nomeBandaTela.innerText = m.banda;
  letraDiv.innerText = m.letra || "";
  letraDiv.style.fontSize = "24px"; // tamanho fixo

  if (m.capa) {
    capaMusica.src = m.capa;
    capaMusica.style.display = "block";
  } else {
    capaMusica.style.display = "none";
  }
}

btnFoto.onclick = () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      musicas[musicaAtual].capa = reader.result;
      salvar();
      abrirMusica(musicaAtual);
      atualizarMenu();
    };
    reader.readAsDataURL(file);
  };
  input.click();
};

btnFotoMulti.onclick = () => {
  const checkboxes = document.querySelectorAll(".selecionarCheckbox:checked");
  if(checkboxes.length === 0) { alert("Selecione ao menos uma música."); return; }
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      checkboxes.forEach(chk => {
        const idx = parseInt(chk.dataset.index);
        musicas[idx].capa = reader.result;
      });
      salvar();
      atualizarMenu();
    };
    reader.readAsDataURL(file);
  };
  input.click();
};

btnApagarMulti.onclick = apagarSelecionadas;

btnVoltar.onclick = () => location.reload();

addMusica.onclick = () => {
  let nome = prompt("Nome da música:");
  if (!nome) return;
  let banda = prompt("Nome da banda:");
  if (!banda) return;

  nome = capitalizar(nome);
  banda = capitalizar(banda);

  musicas.push({ nome, banda, letra:"", capa:"", tamanhoFonte:24 });
  salvar();
  atualizarMenu();
};

btnAddEditarLetra.onclick = () => {
  const texto = prompt("Digite a letra:", musicas[musicaAtual].letra || "");
  if (texto !== null) {
    musicas[musicaAtual].letra = texto;
    salvar();
    abrirMusica(musicaAtual);
  }
};

toggleOrdem.onclick = () => {
  ordemInvertida = !ordemInvertida;
  atualizarMenu();
};

// Pesquisa em tempo real
barraPesquisa.addEventListener("input", atualizarMenu);

atualizarMenu();
</script>

</body>
</html>